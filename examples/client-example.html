<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>emit.gg - Client Example</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f0f0f;
      color: #e0e0e0;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    h1 {
      color: #00ff88;
      margin-bottom: 20px;
    }
    .status {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding: 10px;
      background: #1a1a1a;
      border-radius: 8px;
    }
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ff4444;
    }
    .status-dot.connected {
      background: #00ff88;
    }
    .chat-box {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 15px;
      height: 300px;
      overflow-y: auto;
      margin-bottom: 15px;
    }
    .message {
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 4px;
      background: #252525;
    }
    .message.system {
      color: #888;
      font-style: italic;
    }
    .message.sent {
      background: #003322;
      border-left: 3px solid #00ff88;
    }
    .message.received {
      background: #222233;
      border-left: 3px solid #4488ff;
    }
    .input-row {
      display: flex;
      gap: 10px;
    }
    input {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #1a1a1a;
      color: #e0e0e0;
      font-size: 16px;
    }
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      background: #00ff88;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #00cc66;
    }
    button:disabled {
      background: #333;
      color: #666;
      cursor: not-allowed;
    }
    .controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
    .controls button {
      flex: 1;
    }
    .latency {
      font-size: 12px;
      color: #888;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸš€ emit.gg</h1>
    
    <div class="status">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">Disconnected</span>
      <span id="clientId" style="margin-left: auto; color: #888; font-size: 12px;"></span>
    </div>
    
    <div class="chat-box" id="chatBox"></div>
    
    <div class="input-row">
      <input type="text" id="messageInput" placeholder="Type a message..." disabled>
      <button id="sendBtn" disabled>Send</button>
    </div>
    
    <div class="controls">
      <button id="connectBtn">Connect</button>
      <button id="pingBtn" disabled>Ping</button>
    </div>
    
    <div class="latency" id="latency"></div>
  </div>

  <script>
    // Inline minimal client for demo (in production, use the npm package)
    class EmitClient {
      constructor(url, options = {}) {
        this.url = url;
        this.options = {
          autoReconnect: true,
          reconnectInterval: 1000,
          maxReconnectAttempts: 10,
          ...options
        };
        this.ws = null;
        this._listeners = new Map();
        this._reconnectAttempts = 0;
        this._connected = false;
        this._intentionalClose = false;
      }

      connect() {
        this._intentionalClose = false;
        this._createConnection();
        return this;
      }

      _createConnection() {
        this.ws = new WebSocket(this.url);

        this.ws.onopen = () => {
          this._connected = true;
          this._reconnectAttempts = 0;
          this._emit('connect');
        };

        this.ws.onmessage = (event) => {
          try {
            const { event: name, data } = JSON.parse(event.data);
            this._emit(name, data);
          } catch {}
        };

        this.ws.onclose = () => {
          this._connected = false;
          this._emit('disconnect');
          if (!this._intentionalClose && this.options.autoReconnect) {
            if (this._reconnectAttempts < this.options.maxReconnectAttempts) {
              this._reconnectAttempts++;
              setTimeout(() => this._createConnection(), this.options.reconnectInterval);
            }
          }
        };

        this.ws.onerror = (err) => this._emit('error', err);
      }

      _emit(event, data) {
        const listeners = this._listeners.get(event);
        if (listeners) listeners.forEach(fn => fn(data));
      }

      on(event, callback) {
        if (!this._listeners.has(event)) this._listeners.set(event, []);
        this._listeners.get(event).push(callback);
        return this;
      }

      emit(event, data) {
        if (this.ws?.readyState === 1) {
          this.ws.send(JSON.stringify({ event, data }));
        }
        return this;
      }

      disconnect() {
        this._intentionalClose = true;
        this.ws?.close();
      }

      get connected() { return this._connected; }
    }

    // App
    const chatBox = document.getElementById('chatBox');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const connectBtn = document.getElementById('connectBtn');
    const pingBtn = document.getElementById('pingBtn');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const clientIdEl = document.getElementById('clientId');
    const latencyEl = document.getElementById('latency');

    let client = null;
    let pingStart = 0;

    function addMessage(text, type = 'system') {
      const div = document.createElement('div');
      div.className = `message ${type}`;
      div.textContent = text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function updateStatus(connected) {
      statusDot.classList.toggle('connected', connected);
      statusText.textContent = connected ? 'Connected' : 'Disconnected';
      messageInput.disabled = !connected;
      sendBtn.disabled = !connected;
      pingBtn.disabled = !connected;
      connectBtn.textContent = connected ? 'Disconnect' : 'Connect';
    }

    function connect() {
      client = new EmitClient('ws://localhost:3000');

      client.on('connect', () => {
        updateStatus(true);
        addMessage('Connected to server');
      });

      client.on('disconnect', () => {
        updateStatus(false);
        addMessage('Disconnected from server');
        clientIdEl.textContent = '';
      });

      client.on('welcome', (data) => {
        addMessage(`Welcome! ${data.connectedClients} client(s) online`);
        clientIdEl.textContent = `ID: ${data.yourId}`;
      });

      client.on('user:joined', (data) => {
        addMessage(`User joined (${data.totalClients} online)`);
      });

      client.on('user:left', (data) => {
        addMessage(`User left (${data.totalClients} online)`);
      });

      client.on('chat', (data) => {
        addMessage(`${data.from.slice(0, 8)}: ${data.message}`, 'received');
      });

      client.on('chat:sent', () => {
        // Message confirmed
      });

      client.on('pong', (data) => {
        const latency = Date.now() - pingStart;
        latencyEl.textContent = `Latency: ${latency}ms`;
      });

      client.connect();
    }

    function disconnect() {
      client?.disconnect();
      client = null;
    }

    connectBtn.addEventListener('click', () => {
      if (client?.connected) {
        disconnect();
      } else {
        connect();
      }
    });

    sendBtn.addEventListener('click', () => {
      const message = messageInput.value.trim();
      if (message && client?.connected) {
        client.emit('chat', { message });
        addMessage(`You: ${message}`, 'sent');
        messageInput.value = '';
      }
    });

    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendBtn.click();
    });

    pingBtn.addEventListener('click', () => {
      pingStart = Date.now();
      client?.emit('ping');
    });
  </script>
</body>
</html>
